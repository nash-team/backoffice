<!-- Zone d'erreur OOB (cibl√©e par le serveur si erreur) -->
<div id="ebookFormErrors" class="mb-3" aria-live="assertive" data-testid="error-container"></div>

<div x-data="ebookForm()" x-init="init()">
<form id="ebookForm"
      data-testid="ebook-form"
      hx-post="/api/dashboard/ebooks"
      hx-target="#ebooksTableContainer"
      hx-swap="innerHTML"
      hx-disabled-elt="#createBtn"
      hx-indicator="#createBtnSpinner">

  <!-- Type d'ebook (coloriage uniquement) -->
  <input type="hidden" name="ebook_type" value="coloring">

  <!-- √âtape 1: Th√®me et audience -->
  <div class="mb-4" id="themeSection">
    <h6 class="fw-bold text-primary">
      <i class="fas fa-paint-brush me-2"></i>
      1. Th√®me et audience
    </h6>

    <!-- S√©lection du th√®me -->
    <div class="mb-3">
      <label for="theme_id" class="form-label">
        <strong>Th√®me</strong>
        <small class="text-muted">(Choisissez un th√®me pr√©d√©fini)</small>
      </label>
      <select class="form-select" id="theme_id" name="theme_id"
              x-model="selectedTheme"
              x-on:change="validateForm"
              data-testid="theme-select"
              required>
        <option value="">S√©lectionnez un th√®me...</option>
        <option value="dinosaurs">Dinosaures</option>
        <option value="unicorns">Licornes</option>
        <option value="pirates">Pirates</option>
      </select>
      <div class="form-text">
        üí° <strong>Tip :</strong> Le th√®me d√©terminera automatiquement le style et les couleurs des illustrations.
      </div>
    </div>

    <!-- S√©lection de l'√¢ge -->
    <div class="mb-3">
      <label for="audience" class="form-label">
        <strong>Tranche d'√¢ge</strong>
        <small class="text-muted">(Public cible)</small>
      </label>
      <select class="form-select" id="audience" name="audience"
              x-model="selectedAudience"
              x-on:change="validateForm"
              data-testid="audience-select"
              required>
        <option value="">S√©lectionnez une tranche d'√¢ge...</option>
        <option value="3-5">3-5 ans (Tout petits)</option>
        <option value="6-8">6-8 ans (Premiers lecteurs)</option>
        <option value="9-12">9-12 ans (Pr√©-adolescents)</option>
      </select>
      <div class="form-text">
        üí° <strong>Tip :</strong> L'√¢ge influence la complexit√© et le style des illustrations.
      </div>
    </div>
  </div>

  <!-- √âtape 2: Configuration -->
  <div class="mb-4">
    <h6 class="fw-bold text-primary">
      <i class="fas fa-cog me-2"></i>
      2. Configuration
    </h6>

    <!-- Nombre de pages -->
    <div class="mb-3">
      <label for="number_of_pages" class="form-label">
        <strong>Nombre de pages de coloriage</strong>
        <small class="text-muted">(1 √† 30)</small>
      </label>
      <input type="number"
             class="form-control"
             id="number_of_pages"
             name="number_of_pages"
             min="1"
             max="30"
             value="8"
             data-testid="pages-input">
      <div class="form-text">
        üí° <strong>Tip :</strong> Chaque page contiendra une image diff√©rente √† colorier.
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="title" class="form-label">Titre de l'ebook <small class="text-muted">(optionnel)</small></label>
          <input type="text" class="form-control" id="title" name="title"
                 placeholder="Ex: Les Aventures de Luna (g√©n√©r√© automatiquement si vide)">
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="author" class="form-label">Auteur</label>
          <input type="text" class="form-control" id="author" name="author" value="Assistant IA">
        </div>
      </div>
    </div>
  </div>


  <!-- Boutons -->
  <div class="d-flex justify-content-between">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-testid="cancel-btn">
      Annuler
    </button>
    <button id="createBtn" type="submit" class="btn btn-primary" data-testid="create-btn">
      <span id="createBtnSpinner" class="spinner-border spinner-border-sm me-2 htmx-indicator" aria-hidden="true"></span>
      <i class="fas fa-plus me-2" aria-hidden="true"></i>
      Cr√©er l'ebook
    </button>
  </div>
</form>
</div>

<style>
.ebook-type-card {
  cursor: pointer;
  transition: all 0.2s ease;
  border: 2px solid transparent;
  position: relative;
}

.ebook-type-card:hover {
  border-color: #0d6efd;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.ebook-type-card.selected {
  border-color: #0d6efd;
  background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
  box-shadow: 0 6px 12px rgba(13, 110, 253, 0.2);
}

.ebook-type-card.selected::after {
  content: '‚úì';
  position: absolute;
  top: 10px;
  right: 15px;
  background: #0d6efd;
  color: white;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: bold;
}

.theme-card {
  cursor: pointer;
  transition: all 0.2s ease;
  border: 2px solid transparent;
}

.theme-card:hover {
  border-color: #198754;
  transform: translateY(-2px);
}

.theme-card.selected {
  border-color: #198754;
  background-color: #f8fff9;
}

</style>

