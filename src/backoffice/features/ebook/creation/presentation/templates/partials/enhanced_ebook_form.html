<!-- Zone d'erreur OOB (cibl√©e par le serveur si erreur) -->
<div id="ebookFormErrors" class="mb-3" aria-live="assertive" data-testid="error-container"></div>

<form id="ebookForm"
      data-testid="ebook-form"
      hx-post="/api/ebooks"
      hx-target="#ebooksTableContainer"
      hx-swap="innerHTML"
      hx-disabled-elt="#createBtn"
      hx-on::after-request="
          if(event.detail.successful) {
              createToast('Ebook cr√©√© avec succ√®s !', 'success');
              const modal = document.getElementById('previewModal');
              if (modal) {
                  const modalInstance = bootstrap.Modal.getInstance(modal);
                  if (modalInstance) {
                      modalInstance.hide();
                  }
              }
          }
      ">

  <!-- Type d'ebook (coloriage uniquement) -->
  <input type="hidden" name="ebook_type" value="coloring">


  <!-- √âtape 1: Th√®me et audience -->
  <div class="mb-4" id="themeSection">
    <h6 class="fw-bold text-primary">
      <i class="fas fa-paint-brush me-2"></i>
      1. Th√®me et audience
    </h6>

    <!-- S√©lection du th√®me -->
    <div class="mb-3">
      <label for="theme_id" class="form-label">
        <strong>Th√®me</strong>
        <small class="text-muted">(Choisissez un th√®me pr√©d√©fini)</small>
      </label>
      <select class="form-select" id="theme_id" name="theme_id"
              data-testid="theme-select"
              required>
        <option value="">S√©lectionnez un th√®me...</option>
        {% for theme in themes %}
        <option value="{{ theme.id }}" title="{{ theme.description }}">{{ theme.label }}</option>
        {% endfor %}
      </select>
      <div class="form-text">
        üí° <strong>Tip :</strong> Le th√®me d√©terminera automatiquement le style et les couleurs des illustrations.
      </div>
    </div>

    <!-- S√©lection de l'audience -->
    <div class="mb-3">
      <label for="audience" class="form-label">
        <strong>Audience</strong>
        <small class="text-muted">(Public cible)</small>
      </label>
      <select class="form-select" id="audience" name="audience"
              data-testid="audience-select"
              required>
        <option value="">S√©lectionnez une audience...</option>
        {% for audience in audiences %}
        <option value="{{ audience.id }}" title="{{ audience.complexity }}">{{ audience.label }}</option>
        {% endfor %}
      </select>
      <div class="form-text">
        üí° <strong>Tip :</strong> L'audience influence la complexit√© et le style des illustrations.
      </div>
    </div>
  </div>

  <!-- √âtape 2: Configuration -->
  <div class="mb-4">
    <h6 class="fw-bold text-primary">
      <i class="fas fa-cog me-2"></i>
      2. Configuration
    </h6>

    <!-- Nombre de pages -->
    <div class="mb-3">
      <label for="number_of_pages" class="form-label">
        <strong>Nombre de pages de coloriage</strong>
        <small class="text-muted">(24 √† 30 - minimum KDP)</small>
      </label>
      <input type="number"
             class="form-control"
             id="number_of_pages"
             name="number_of_pages"
             min="24"
             max="30"
             value="24"
             data-testid="pages-input">
      <div class="form-text">
        üí° <strong>Tip :</strong> Amazon KDP impose un minimum de 24 pages pour l'impression paperback.
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="title" class="form-label">Titre de l'ebook <small class="text-muted">(optionnel)</small></label>
          <input type="text" class="form-control" id="title" name="title"
                 placeholder="Ex: Les Aventures de Luna (g√©n√©r√© automatiquement si vide)">
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="author" class="form-label">Auteur</label>
          <input type="text" class="form-control" id="author" name="author" value="Assistant IA">
        </div>
      </div>
    </div>
  </div>


  <!-- Boutons -->
  <div class="d-flex justify-content-between">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-testid="cancel-btn">
      Annuler
    </button>
    <div class="d-flex gap-2">
      <button type="submit"
              class="btn btn-info d-inline-flex align-items-center gap-2"
              data-testid="preview-btn"
              hx-post="/api/ebooks"
              hx-target="#ebooksTableContainer"
              hx-swap="innerHTML"
              hx-vals='{"preview_mode": "true"}'
              hx-include="#ebookForm [name]">
        <span class="spinner-border spinner-border-sm preview-spinner" role="status" aria-hidden="true"></span>
        <i class="fas fa-eye preview-icon" aria-hidden="true"></i>
        <span>Aper√ßu Rapide (3 pages)</span>
      </button>
      <button type="submit"
              class="btn btn-primary d-inline-flex align-items-center gap-2"
              data-testid="create-btn"
              hx-post="/api/ebooks"
              hx-target="#ebooksTableContainer"
              hx-swap="innerHTML"
              hx-vals='{"preview_mode": "false"}'
              hx-include="#ebookForm [name]">
        <span class="spinner-border spinner-border-sm create-spinner" role="status" aria-hidden="true"></span>
        <i class="fas fa-book create-icon" aria-hidden="true"></i>
        <span>Cr√©er Ebook Complet</span>
      </button>
    </div>
  </div>
</form>
